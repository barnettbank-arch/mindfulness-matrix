<script>
  // Set footer year
  document.getElementById('year').textContent = new Date().getFullYear();

  // Approximate next new moon calculation
  function getNextNewMoon() {
    // Base: a known recent new moon (adjust as needed)
    const base = new Date('2024-11-01T13:47:00Z');
    const lunationMs = 29.5306 * 24 * 60 * 60 * 1000; // ~29.53 days
    const now = new Date();

    let t = base.getTime();
    while (t <= now.getTime()) {
      t += lunationMs;
    }
    return new Date(t);
  }

  const nextNewMoon = getNextNewMoon();

  function updateMoonCountdown() {
    const now = new Date();
    const diff = nextNewMoon - now;

    const bannerEl = document.getElementById('moon-banner-timer');
    const bigEl = document.getElementById('moon-timer');

    if (!bannerEl && !bigEl) return;

    if (diff <= 0) {
      if (bannerEl) bannerEl.textContent = 'Happening now';
      if (bigEl) bigEl.textContent = 'New moon window is open';
      return;
    }

    const totalSeconds = Math.floor(diff / 1000);
    const days = Math.floor(totalSeconds / (24 * 3600));
    const hours = Math.floor((totalSeconds % (24 * 3600)) / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;

    const text =
      days + 'd · ' +
      hours + 'h · ' +
      minutes + 'm · ' +
      seconds + 's';

    if (bannerEl) bannerEl.textContent = text;
    if (bigEl) bigEl.textContent = text;
  }

  // Initial call + live ticking countdown
  updateMoonCountdown();
  setInterval(updateMoonCountdown, 1000);
</script>
